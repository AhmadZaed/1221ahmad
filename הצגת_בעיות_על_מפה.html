<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הצגת בעיות על מפה</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
           body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            direction: rtl;
        }
        .container {
            display: flex;
            flex-direction: row;
            max-width: 1200px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #map {
            width: 70%;
            height: 600px;
            margin-left: 20px;
        }
        table {
            width: 30%;
            border-collapse: collapse;
            text-align: center;
        }
        table th, table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        table th {
            background-color: #f4f4f4;
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <!-- טבלה של הדוחות -->
        <table>
            <thead>
                <tr>
                    <th>תיאור</th>
                    <th>סטטוס</th>
                    <th>דחיפות</th>
                </tr>
            </thead>
            <tbody id="reports-table-body">
                <!-- השורות יתווספו דינאמית -->
            </tbody>
        </table>

        <!-- מפה -->
        <div id="map"></div>
    </div>

    <script>
        // נתוני הדוחות ממעקב אחרי פעיות
        let reports = JSON.parse(localStorage.getItem('reports')) || [
            { description: 'דוח 1', status: 'ממתין', priority: 1, latitude: 31.0461, longitude: 34.8516 },
            { description: 'דוח 2', status: 'בטיפול', priority: 2, latitude: 31.0462, longitude: 34.8517 },
            { description: 'דוח 3', status: 'טופל', priority: 3, latitude: 31.0463, longitude: 34.8518 }
        ];

        // מפה
        const map = L.map('map').setView([31.0461, 34.8516], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // צבעים לפי סטטוס
        const statusColors = {
            'ממתין': 'red',
            'בטיפול': 'orange',
            'טופל': 'green'
        };

        // הוספת נקודות למפה
        function displayReportsOnMap() {
            reports.forEach(report => {
                const marker = L.circleMarker([report.latitude, report.longitude], {
                    color: statusColors[report.status],
                    radius: getUrgencyRadius(report.priority) // גודל הנקודה לפי דחיפות
                }).addTo(map);

                marker.bindPopup(`
                    <b>תיאור:</b> ${report.description}<br>
                    <b>סטטוס:</b> ${report.status}<br>
                    <b>דחיפות:</b> ${getPriorityText(report.priority)}
                `);
            });
        }

        // גודל הנקודה לפי רמת הדחיפות
        function getUrgencyRadius(priority) {
            switch (priority) {
                case 1:
                    return 12;
                case 2:
                    return 8;
                case 3:
                    return 5;
                default:
                    return 6;
            }
        }

        // תרגום המספר לדחיפות
        function getPriorityText(priority) {
            switch (priority) {
                case 1:
                    return 'גבוהה';
                case 2:
                    return 'בינונית';
                case 3:
                    return 'נמוכה';
                default:
                    return 'לא הוגדרה';
            }
        }

        // הצגת הטבלה
        function displayReportsInTable() {
            const tableBody = document.getElementById('reports-table-body');
            tableBody.innerHTML = ''; // איפוס התוכן הקודם
            reports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.description}</td>
                    <td>${report.status}</td>
                    <td>${getPriorityText(report.priority)}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // שמירת דוחות ב-localStorage
        function saveReports() {
            localStorage.setItem('reports', JSON.stringify(reports));
        }

        // הצגת הדוחות על המפה ובטבלה
        displayReportsOnMap();
        displayReportsInTable();
    </script>
</body>
</html>